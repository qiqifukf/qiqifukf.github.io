<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导航网站管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // 配置Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .form-input {
                @apply w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none transition-all;
            }
            .btn {
                @apply px-4 py-2 rounded-lg font-medium transition-all;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-primary/90 active:bg-primary/80;
            }
            .btn-secondary {
                @apply bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300;
            }
            .btn-danger {
                @apply bg-danger text-white hover:bg-danger/90 active:bg-danger/80;
            }
            .table-row-animate {
                @apply transition-all duration-200;
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">
    <!-- 密码验证界面 -->
    <div id="password-protection" class="fixed inset-0 flex items-center justify-center bg-gray-100 z-50 p-4">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full">
            <div class="text-center mb-6">
                <i class="fa fa-lock text-4xl text-primary mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">请输入管理密码</h2>
                <p class="text-gray-500 mt-2">此管理界面受密码保护</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label for="password-input" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <input type="password" id="password-input" placeholder="请输入密码" class="form-input">
                    <p id="password-error" class="text-danger text-sm mt-1 hidden">密码不正确，请重新输入</p>
                </div>
                
                <button id="submit-password" class="btn btn-primary w-full">
                    <i class="fa fa-unlock-alt mr-1"></i>验证并进入
                </button>
            </div>
        </div>
    </div>

    <!-- 主内容容器 (初始隐藏) -->
    <div id="main-content" class="hidden">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-sm sticky top-0 z-10">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-2">
                        <a href="index.html" class="flex items-center gap-2">
                            <i class="fa fa-compass text-primary text-2xl"></i>
                            <span class="text-xl font-bold">导航中心管理</span>
                        </a>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="hidden md:block">
                            <span class="text-sm text-gray-500">上次更新: <span id="last-update">从未</span></span>
                        </div>
                        <a href="index.html" class="flex items-center gap-1 px-3 py-1.5 rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all">
                            <i class="fa fa-home"></i>
                            <span>返回首页</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="container mx-auto px-4 py-6">
            <!-- 状态提示栏 -->
            <div id="status-bar" class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-6 hidden fade-in">
                <div class="flex items-start gap-3">
                    <i class="fa fa-info-circle text-blue-500 mt-0.5"></i>
                    <div class="flex-1">
                        <h3 class="font-medium text-blue-800">提示</h3>
                        <p class="text-sm text-blue-700 mt-1" id="status-message">所有更改会自动保存到本地</p>
                    </div>
                    <button id="close-status" class="text-blue-400 hover:text-blue-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- 管理标签页 -->
            <div class="mb-6 border-b border-gray-200">
                <div class="flex overflow-x-auto -mb-px">
                    <button id="websites-tab" class="py-4 px-5 border-b-2 border-primary text-primary font-medium whitespace-nowrap">
                        <i class="fa fa-globe mr-2"></i>网站管理
                    </button>
                    <button id="categories-tab" class="py-4 px-5 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium whitespace-nowrap">
                        <i class="fa fa-folder mr-2"></i>分类管理
                    </button>
                    <button id="settings-tab" class="py-4 px-5 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium whitespace-nowrap">
                        <i class="fa fa-cog mr-2"></i>设置
                    </button>
                </div>
            </div>

            <!-- 网站管理面板 -->
            <div id="websites-panel" class="space-y-6">
                <!-- 操作按钮和统计信息 -->
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">网站列表</h2>
                        <p class="text-sm text-gray-500 mt-1" id="websites-count">共 <span>0</span> 个网站</p>
                    </div>
                    <div class="flex gap-3 flex-wrap">
                        <button id="add-website-btn" class="btn btn-primary flex items-center gap-1">
                            <i class="fa fa-plus"></i>
                            <span>添加网站</span>
                        </button>
                        <div class="relative group">
                            <button class="btn btn-secondary flex items-center gap-1">
                                <i class="fa fa-cog"></i>
                                <span>批量操作</span>
                                <i class="fa fa-chevron-down text-xs ml-1"></i>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10 hidden group-hover:block">
                                <button id="batch-delete" class="w-full text-left px-4 py-2 text-sm text-danger hover:bg-gray-100">
                                    <i class="fa fa-trash mr-2"></i>删除选中项
                                </button>
                                <button id="batch-category" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fa fa-folder mr-2"></i>批量修改分类
                                </button>
                            </div>
                        </div>
                        <button id="import-websites-btn" class="btn btn-secondary flex items-center gap-1">
                            <i class="fa fa-upload"></i>
                            <span>导入</span>
                        </button>
                        <button id="export-websites-btn" class="btn btn-secondary flex items-center gap-1">
                            <i class="fa fa-download"></i>
                            <span>导出</span>
                        </button>
                    </div>
                </div>

                <!-- 搜索和筛选 -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" id="websites-search" placeholder="搜索网站名称或URL..." class="form-input">
                        </div>
                        <div class="w-full md:w-48">
                            <select id="category-filter" class="form-input">
                                <option value="">所有分类</option>
                                <!-- 分类选项将通过JS动态生成 -->
                            </select>
                        </div>
                        <div class="w-full md:w-auto self-end">
                            <button id="clear-filters" class="btn btn-secondary">
                                <i class="fa fa-refresh mr-1"></i>重置
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 网站列表表格 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">
                                    <input type="checkbox" id="select-all" class="rounded border-gray-300 text-primary focus:ring-primary">
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">图标</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">名称</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">URL</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分类</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">添加时间</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="websites-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 网站数据将通过JS动态生成 -->
                        </tbody>
                    </table>
                    
                    <!-- 空状态 -->
                    <div id="websites-empty-state" class="py-16 text-center hidden">
                        <i class="fa fa-folder-open-o text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">没有找到网站数据</p>
                        <button id="add-first-website" class="mt-4 btn btn-primary">
                            <i class="fa fa-plus mr-1"></i>添加第一个网站
                        </button>
                    </div>

                    <!-- 加载状态 -->
                    <div id="websites-loading" class="py-16 text-center hidden">
                        <i class="fa fa-circle-o-notch fa-spin text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">加载中...</p>
                    </div>
                </div>
            </div>

            <!-- 分类管理面板 -->
            <div id="categories-panel" class="space-y-6 hidden">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">分类管理</h2>
                        <p class="text-sm text-gray-500 mt-1" id="categories-count">共 <span>0</span> 个分类</p>
                    </div>
                    <button id="add-category-btn" class="btn btn-primary flex items-center gap-1">
                        <i class="fa fa-plus"></i>
                        <span>添加分类</span>
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">图标</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分类名称</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">网站数量</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">占比</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="categories-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 分类数据将通过JS动态生成 -->
                        </tbody>
                    </table>
                </div>

                <!-- 分类统计图表 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">分类分布统计</h3>
                    <div class="h-64">
                        <canvas id="categories-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 设置面板 -->
            <div id="settings-panel" class="space-y-6 hidden">
                <h2 class="text-xl font-bold text-gray-800">系统设置</h2>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">网站设置</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="site-name" class="block text-sm font-medium text-gray-700 mb-1">网站名称</label>
                            <input type="text" id="site-name" value="导航中心" class="form-input">
                        </div>
                        
                        <div>
                            <label for="site-description" class="block text-sm font-medium text-gray-700 mb-1">网站描述</label>
                            <input type="text" id="site-description" value="简洁高效的网站导航" class="form-input">
                        </div>
                        
                        <div>
                            <label for="site-logo" class="block text-sm font-medium text-gray-700 mb-1">网站Logo URL</label>
                            <div class="flex gap-2">
                                <input type="url" id="site-logo" value="https://picsum.photos/48/48" class="form-input flex-1">
                                <button type="button" id="preview-logo" class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                            <div id="logo-preview-container" class="mt-2 hidden">
                                <img id="logo-preview" src="" alt="Logo预览" class="h-12 rounded-lg border border-gray-200">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">主题设置</label>
                            <div class="flex gap-4">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="theme" value="light" checked class="form-radio text-primary">
                                    <span class="ml-2">浅色主题</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="theme" value="dark" class="form-radio text-primary">
                                    <span class="ml-2">深色主题</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="theme" value="auto" class="form-radio text-primary">
                                    <span class="ml-2">跟随系统</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button id="save-settings" class="btn btn-primary">
                            <i class="fa fa-save mr-1"></i>保存设置
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">数据管理</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <button id="export-all-data" class="btn btn-secondary mr-3">
                                <i class="fa fa-download mr-1"></i>导出所有数据
                            </button>
                            <button id="import-all-data" class="btn btn-secondary mr-3">
                                <i class="fa fa-upload mr-1"></i>导入所有数据
                            </button>
                            <input type="file" id="import-file" accept=".json" class="hidden">
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <button id="backup-data" class="btn btn-secondary mr-3">
                                <i class="fa fa-database mr-1"></i>创建备份
                            </button>
                            <button id="restore-data" class="btn btn-secondary mr-3">
                                <i class="fa fa-undo mr-1"></i>恢复备份
                            </button>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <button id="reset-to-defaults" class="btn btn-danger">
                                <i class="fa fa-refresh mr-1"></i>恢复默认数据
                            </button>
                            <p class="text-sm text-gray-500 mt-2">此操作将清除所有自定义数据，恢复到初始状态</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">关于</h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <p>导航中心 v1.0.0</p>
                        <p>一个简洁高效的静态网站导航工具</p>
                        <p>所有数据存储在本地浏览器中，保护您的隐私</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- 添加/编辑网站模态框 -->
        <div id="website-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-auto transform transition-all">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 id="website-modal-title" class="text-lg font-bold text-gray-800">添加网站</h3>
                        <button id="close-website-modal" class="text-gray-400 hover:text-gray-500">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6 space-y-4">
                    <form id="website-form">
                        <input type="hidden" id="website-id">
                        <input type="hidden" id="website-created-at">
                        
                        <div>
                            <label for="website-name" class="block text-sm font-medium text-gray-700 mb-1">网站名称 <span class="text-danger">*</span></label>
                            <input type="text" id="website-name" required class="form-input">
                        </div>
                        
                        <div>
                            <label for="website-url" class="block text-sm font-medium text-gray-700 mb-1">网站URL <span class="text-danger">*</span></label>
                            <input type="url" id="website-url" required placeholder="https://example.com" class="form-input">
                        </div>
                        
                        <div>
                            <label for="website-category" class="block text-sm font-medium text-gray-700 mb-1">分类 <span class="text-danger">*</span></label>
                            <select id="website-category" required class="form-input">
                                <!-- 分类选项将通过JS动态生成 -->
                            </select>
                        </div>
                        
                        <div>
                            <label for="website-icon" class="block text-sm font-medium text-gray-700 mb-1">图标URL (可选)</label>
                            <div class="flex gap-2">
                                <input type="url" id="website-icon" placeholder="https://example.com/icon.ico" class="form-input flex-1">
                                <button type="button" id="auto-fetch-icon" class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
                                    <i class="fa fa-magic"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">留空将自动获取网站favicon</p>
                            <div class="mt-2 flex items-center gap-2">
                                <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img id="icon-preview" src="https://picsum.photos/40/40" alt="图标预览" class="w-full h-full object-contain p-1">
                                </div>
                                <span class="text-xs text-gray-500">图标预览</span>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="p-4 flex justify-end gap-3 border-t border-gray-200">
                    <button id="cancel-website" class="btn btn-secondary">取消</button>
                    <button id="save-website" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>

        <!-- 批量修改分类模态框 -->
        <div id="batch-category-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-auto transform transition-all">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-bold text-gray-800">批量修改分类</h3>
                        <button id="close-batch-category-modal" class="text-gray-400 hover:text-gray-500">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6 space-y-4">
                    <div>
                        <label for="batch-new-category" class="block text-sm font-medium text-gray-700 mb-1">目标分类 <span class="text-danger">*</span></label>
                        <select id="batch-new-category" required class="form-input">
                            <!-- 分类选项将通过JS动态生成 -->
                        </select>
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-700">
                        <i class="fa fa-info-circle mr-1"></i>
                        <span id="batch-count-text">将把选中的 <span>0</span> 个网站修改为选中分类</span>
                    </div>
                </div>
                
                <div class="p-4 flex justify-end gap-3 border-t border-gray-200">
                    <button id="cancel-batch-category" class="btn btn-secondary">取消</button>
                    <button id="confirm-batch-category" class="btn btn-primary">确认修改</button>
                </div>
            </div>
        </div>

        <!-- 添加/编辑分类模态框 -->
        <div id="category-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-auto transform transition-all">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 id="category-modal-title" class="text-lg font-bold text-gray-800">添加分类</h3>
                        <button id="close-category-modal" class="text-gray-400 hover:text-gray-500">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6 space-y-4">
                    <form id="category-form">
                        <input type="hidden" id="category-id">
                        
                        <div>
                            <label for="category-name" class="block text-sm font-medium text-gray-700 mb-1">分类名称 <span class="text-danger">*</span></label>
                            <input type="text" id="category-name" required class="form-input">
                        </div>
                        
                        <div>
                            <label for="category-icon" class="block text-sm font-medium text-gray-700 mb-1">图标选择</label>
                            <div class="grid grid-cols-8 gap-2 p-2 border border-gray-200 rounded-lg">
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-globe">
                                    <i class="fa fa-globe"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-search">
                                    <i class="fa fa-search"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-users">
                                    <i class="fa fa-users"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-play-circle">
                                    <i class="fa fa-play-circle"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-newspaper-o">
                                    <i class="fa fa-newspaper-o"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-shopping-cart">
                                    <i class="fa fa-shopping-cart"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-graduation-cap">
                                    <i class="fa fa-graduation-cap"></i>
                                </button>
                                <button type="button" class="category-icon-option w-10 h-10 flex items-center justify-center rounded hover:bg-gray-100" data-icon="fa-gamepad">
                                    <i class="fa fa-gamepad"></i>
                                </button>
                            </div>
                            <input type="hidden" id="category-icon" value="fa-globe">
                        </div>
                    </form>
                </div>
                
                <div class="p-4 flex justify-end gap-3 border-t border-gray-200">
                    <button id="cancel-category" class="btn btn-secondary">取消</button>
                    <button id="save-category" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>

        <!-- 确认对话框 - 新增处理分类删除的选项 -->
        <div id="confirm-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-auto transform transition-all">
                <div class="p-6 border-b border-gray-200">
                    <h3 id="confirm-title" class="text-lg font-bold text-gray-800">确认操作</h3>
                </div>
                
                <div class="p-6">
                    <p id="confirm-message" class="text-gray-700">您确定要执行此操作吗？</p>
                    
                    <!-- 分类删除时显示的额外选项 -->
                    <div id="category-delete-options" class="mt-4 hidden">
                        <p class="text-sm text-gray-600 mb-2">请选择如何处理该分类下的网站：</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="category-delete-action" value="delete" class="form-radio text-primary" checked>
                                <span class="ml-2 text-sm">同时删除这些网站</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="category-delete-action" value="move" class="form-radio text-primary">
                                <span class="ml-2 text-sm">移动到其他分类</span>
                            </label>
                        </div>
                        
                        <div id="move-to-category-container" class="mt-3 hidden">
                            <select id="move-to-category" class="form-input text-sm">
                                <!-- 分类选项将通过JS动态生成 -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 flex justify-end gap-3 border-t border-gray-200">
                    <button id="confirm-cancel" class="btn btn-secondary">取消</button>
                    <button id="confirm-ok" class="btn btn-danger">确认</button>
                </div>
            </div>
        </div>

        <!-- 通知提示 -->
        <div id="toast" class="fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2">
            <i id="toast-icon" class="fa fa-check-circle text-white"></i>
            <span id="toast-message" class="text-white font-medium"></span>
        </div>
    </div>

    <!-- 引入Chart.js用于图表展示 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

    <script>
        // 密码验证功能
        document.addEventListener('DOMContentLoaded', function() {
            const passwordProtection = document.getElementById('password-protection');
            const mainContent = document.getElementById('main-content');
            const passwordInput = document.getElementById('password-input');
            const submitPassword = document.getElementById('submit-password');
            const passwordError = document.getElementById('password-error');
            const correctPassword = 'Cib95561/*/';

            // 密码提交验证
            submitPassword.addEventListener('click', verifyPassword);
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyPassword();
                }
            });

            function verifyPassword() {
                if (passwordInput.value === correctPassword) {
                    // 密码正确，显示主内容
                    passwordProtection.classList.add('fade-out');
                    setTimeout(() => {
                        passwordProtection.classList.add('hidden');
                        mainContent.classList.remove('hidden');
                        initAdminPanel(); // 初始化管理面板
                    }, 300);
                } else {
                    // 密码错误，显示错误提示
                    passwordError.classList.remove('hidden');
                    passwordInput.classList.add('border-danger');
                    
                    // 3秒后隐藏错误提示
                    setTimeout(() => {
                        passwordError.classList.add('hidden');
                        passwordInput.classList.remove('border-danger');
                    }, 3000);
                }
            }

            // 添加淡入淡出动画
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
                .fade-out {
                    animation: fadeOut 0.3s ease-in-out;
                }
            `;
            document.head.appendChild(style);
        });

        // 初始化管理面板功能
        function initAdminPanel() {
            // 从localStorage获取网站数据
            function getWebsites() {
                const saved = localStorage.getItem('websites');
                return saved ? JSON.parse(saved) : [];
            }

            // 保存网站数据到localStorage
            function saveWebsites(websites) {
                localStorage.setItem('websites', JSON.stringify(websites));
                updateLastUpdateTime();
            }

            // 获取所有分类 - 修复：确保分类列表正确生成
            function getCategories() {
                const websites = getWebsites();
                const categories = [...new Set(websites.map(website => website.category))];
                
                // 从分类图标映射中添加可能存在但没有网站的分类
                const categoryIcons = JSON.parse(localStorage.getItem('categoryIcons') || '{}');
                const iconCategories = Object.keys(categoryIcons);
                
                // 合并并去重
                return [...new Set([...categories, ...iconCategories])];
            }

            // 获取分类对应的图标
            function getCategoryIcon(category) {
                // 从localStorage获取分类图标映射
                const categoryIcons = JSON.parse(localStorage.getItem('categoryIcons') || '{}');
                return categoryIcons[category] || 'fa-globe';
            }

            // 保存分类图标
            function saveCategoryIcon(category, icon) {
                const categoryIcons = JSON.parse(localStorage.getItem('categoryIcons') || '{}');
                categoryIcons[category] = icon;
                localStorage.setItem('categoryIcons', JSON.stringify(categoryIcons));
            }

            // 获取分类下的网站数量
            function getWebsiteCountByCategory(category) {
                const websites = getWebsites();
                return websites.filter(website => website.category === category).length;
            }

            // 获取网站favicon URL
            function getFaviconUrl(url) {
                try {
                    const parsedUrl = new URL(url);
                    return `${parsedUrl.protocol}//${parsedUrl.hostname}/favicon.ico`;
                } catch (e) {
                    return 'https://picsum.photos/32/32';
                }
            }

            // 更新最后更新时间
            function updateLastUpdateTime() {
                const now = new Date();
                const formattedTime = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                document.getElementById('last-update').textContent = formattedTime;
                localStorage.setItem('lastUpdate', formattedTime);
            }

            // 初始化最后更新时间
            function initLastUpdateTime() {
                const lastUpdate = localStorage.getItem('lastUpdate');
                if (lastUpdate) {
                    document.getElementById('last-update').textContent = lastUpdate;
                }
            }

            // 渲染网站列表
            function renderWebsites(filteredWebsites = null) {
                showLoading('websites');
                
                // 使用setTimeout模拟加载过程，提升用户体验
                setTimeout(() => {
                    const websites = filteredWebsites || getWebsites();
                    const tableBody = document.getElementById('websites-table-body');
                    const emptyState = document.getElementById('websites-empty-state');
                    const websitesCount = document.getElementById('websites-count').querySelector('span');
                    
                    websitesCount.textContent = websites.length;
                    
                    if (websites.length === 0) {
                        tableBody.innerHTML = '';
                        emptyState.classList.remove('hidden');
                        hideLoading('websites');
                        return;
                    }
                    
                    emptyState.classList.add('hidden');
                    tableBody.innerHTML = '';
                    
                    // 按添加时间排序，最新的在前
                    const sortedWebsites = [...websites].sort((a, b) => 
                        new Date(b.createdAt || 0) - new Date(a.createdAt || 0)
                    );
                    
                    sortedWebsites.forEach(website => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50 transition-colors table-row-animate';
                        row.dataset.id = website.id;
                        
                        // 格式化日期
                        const date = website.createdAt ? new Date(website.createdAt) : new Date();
                        const formattedDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="checkbox" class="website-select rounded border-gray-300 text-primary focus:ring-primary" data-id="${website.id}">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img src="${website.icon || getFaviconUrl(website.url)}" alt="${website.name}图标" class="w-full h-full object-contain p-1"
                                        onerror="this.src='https://picsum.photos/32/32?random=${website.id}'">
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${website.name}</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-500 truncate max-w-xs">${website.url}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    ${website.category}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">${formattedDate}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button class="edit-website text-primary hover:text-primary/80 mr-3" data-id="${website.id}">
                                    <i class="fa fa-pencil"></i> 编辑
                                </button>
                                <button class="delete-website text-danger hover:text-danger/80" data-id="${website.id}" data-name="${website.name}">
                                    <i class="fa fa-trash"></i> 删除
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // 绑定编辑和删除事件
                    document.querySelectorAll('.edit-website').forEach(btn => {
                        btn.addEventListener('click', () => editWebsite(parseInt(btn.dataset.id)));
                    });
                    
                    document.querySelectorAll('.delete-website').forEach(btn => {
                        btn.addEventListener('click', () => showDeleteConfirm(
                            parseInt(btn.dataset.id), 
                            btn.dataset.name
                        ));
                    });
                    
                    // 绑定复选框事件
                    document.querySelectorAll('.website-select').forEach(checkbox => {
                        checkbox.addEventListener('change', updateSelectAllStatus);
                    });
                    
                    hideLoading('websites');
                }, 300);
            }

            // 显示加载状态
            function showLoading(panel) {
                if (panel === 'websites') {
                    document.getElementById('websites-loading').classList.remove('hidden');
                    document.getElementById('websites-table-body').classList.add('hidden');
                    document.getElementById('websites-empty-state').classList.add('hidden');
                }
            }

            // 隐藏加载状态
            function hideLoading(panel) {
                if (panel === 'websites') {
                    document.getElementById('websites-loading').classList.add('hidden');
                    document.getElementById('websites-table-body').classList.remove('hidden');
                }
            }

            // 更新全选状态
            function updateSelectAllStatus() {
                const checkboxes = document.querySelectorAll('.website-select');
                const checkedBoxes = document.querySelectorAll('.website-select:checked');
                const selectAll = document.getElementById('select-all');
                
                selectAll.checked = checkboxes.length > 0 && checkboxes.length === checkedBoxes.length;
                updateBatchCountText();
            }

            // 获取选中的网站ID
            function getSelectedWebsiteIds() {
                const checkboxes = document.querySelectorAll('.website-select:checked');
                return Array.from(checkboxes).map(checkbox => parseInt(checkbox.dataset.id));
            }

            // 更新批量操作计数文本
            function updateBatchCountText() {
                const count = getSelectedWebsiteIds().length;
                document.getElementById('batch-count-text').querySelector('span').textContent = count;
            }

            // 显示删除确认对话框
            function showDeleteConfirm(id, name) {
                const confirmModal = document.getElementById('confirm-modal');
                const confirmTitle = document.getElementById('confirm-title');
                const confirmMessage = document.getElementById('confirm-message');
                const confirmOk = document.getElementById('confirm-ok');
                const categoryDeleteOptions = document.getElementById('category-delete-options');
                
                // 隐藏分类删除选项
                categoryDeleteOptions.classList.add('hidden');
                
                // 设置确认框内容
                confirmTitle.textContent = '确认删除';
                confirmMessage.textContent = `您确定要删除网站"${name}"吗？此操作不可撤销。`;
                
                // 显示确认框
                confirmModal.classList.remove('hidden');
                
                // 绑定确认事件
                const okHandler = () => {
                    deleteWebsite(id);
                    confirmModal.classList.add('hidden');
                    confirmOk.removeEventListener('click', okHandler);
                };
                
                confirmOk.addEventListener('click', okHandler);
            }

            // 删除网站
            function deleteWebsite(id) {
                const websites = getWebsites();
                const updatedWebsites = websites.filter(website => website.id !== id);
                saveWebsites(updatedWebsites);
                renderWebsites();
                renderCategories(); // 修复：删除网站后更新分类统计
                initCategoriesChart();
                showToast('网站已删除', 'success');
            }

            // 批量删除网站
            function batchDeleteWebsites() {
                const selectedIds = getSelectedWebsiteIds();
                if (selectedIds.length === 0) {
                    showToast('请先选择要删除的网站', 'warning');
                    return;
                }
                
                const confirmModal = document.getElementById('confirm-modal');
                const confirmTitle = document.getElementById('confirm-title');
                const confirmMessage = document.getElementById('confirm-message');
                const confirmOk = document.getElementById('confirm-ok');
                const categoryDeleteOptions = document.getElementById('category-delete-options');
                
                // 隐藏分类删除选项
                categoryDeleteOptions.classList.add('hidden');
                
                // 设置确认框内容
                confirmTitle.textContent = '确认批量删除';
                confirmMessage.textContent = `您确定要删除选中的${selectedIds.length}个网站吗？此操作不可撤销。`;
                
                // 显示确认框
                confirmModal.classList.remove('hidden');
                
                // 绑定确认事件
                const okHandler = () => {
                    const websites = getWebsites();
                    const updatedWebsites = websites.filter(website => !selectedIds.includes(website.id));
                    saveWebsites(updatedWebsites);
                    renderWebsites();
                    renderCategories(); // 修复：批量删除网站后更新分类统计
                    initCategoriesChart();
                    confirmModal.classList.add('hidden');
                    confirmOk.removeEventListener('click', okHandler);
                    showToast(`已删除${selectedIds.length}个网站`, 'success');
                };
                
                confirmOk.addEventListener('click', okHandler);
            }

            // 编辑网站
            function editWebsite(id) {
                const websites = getWebsites();
                const website = websites.find(w => w.id === id);
                
                if (!website) return;
                
                document.getElementById('website-id').value = website.id;
                document.getElementById('website-name').value = website.name;
                document.getElementById('website-url').value = website.url;
                document.getElementById('website-icon').value = website.icon || '';
                document.getElementById('website-created-at').value = website.createdAt || '';
                
                // 更新图标预览
                updateIconPreview(website.icon || getFaviconUrl(website.url));
                
                // 设置模态框标题
                document.getElementById('website-modal-title').textContent = '编辑网站';
                
                // 显示模态框
                document.getElementById('website-modal').classList.remove('hidden');
                
                // 加载分类选项
                loadCategoryOptions('website-category', website.category);
            }

            // 更新图标预览
            function updateIconPreview(url) {
                const iconPreview = document.getElementById('icon-preview');
                iconPreview.src = url || 'https://picsum.photos/40/40';
                
                // 图片加载失败时显示默认图片
                iconPreview.onerror = function() {
                    this.src = 'https://picsum.photos/40/40';
                };
            }

            // 保存网站
            function saveWebsite() {
                const id = document.getElementById('website-id').value;
                const name = document.getElementById('website-name').value;
                const url = document.getElementById('website-url').value;
                const category = document.getElementById('website-category').value;
                const icon = document.getElementById('website-icon').value;
                const createdAt = document.getElementById('website-created-at').value || new Date().toISOString();
                
                // 验证必填字段
                if (!name || !url || !category) {
                    showToast('请填写所有必填字段', 'error');
                    return;
                }
                
                const websites = getWebsites();
                let updatedWebsites;
                let oldCategory = null;
                
                if (id) {
                    // 更新现有网站 - 修复：跟踪分类变化以更新统计
                    const existingWebsite = websites.find(w => w.id === parseInt(id));
                    oldCategory = existingWebsite.category;
                    
                    updatedWebsites = websites.map(website => 
                        website.id === parseInt(id) 
                            ? { ...website, name, url, category, icon }
                            : website
                    );
                    showToast('网站已更新', 'success');
                } else {
                    // 添加新网站
                    const newWebsite = {
                        id: Date.now(), // 使用时间戳作为唯一ID
                        name,
                        url,
                        category,
                        icon,
                        createdAt
                    };
                    updatedWebsites = [...websites, newWebsite];
                    showToast('网站已添加', 'success');
                }
                
                saveWebsites(updatedWebsites);
                renderWebsites();
                
                // 修复：如果分类有变化，更新分类统计
                if (!id || oldCategory !== category) {
                    renderCategories();
                    initCategoriesChart();
                }
                
                closeWebsiteModal();
            }

            // 关闭网站模态框
            function closeWebsiteModal() {
                document.getElementById('website-modal').classList.add('hidden');
                document.getElementById('website-form').reset();
                document.getElementById('website-id').value = '';
                document.getElementById('website-created-at').value = '';
                document.getElementById('icon-preview').src = 'https://picsum.photos/40/40';
            }

            // 加载分类选项到下拉框
            function loadCategoryOptions(selectId, selectedValue = '') {
                const select = document.getElementById(selectId);
                const categories = getCategories();
                
                // 保存当前选中值
                const currentValue = select.value;
                
                // 清空现有选项（保留第一个"所有分类"选项，如果存在）
                while (select.options.length > (selectId === 'category-filter' ? 1 : 0)) {
                    select.remove(select.options.length - 1);
                }
                
                // 添加分类选项
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    select.appendChild(option);
                });
                
                // 设置选中值
                if (selectedValue) {
                    select.value = selectedValue;
                } else if (currentValue && categories.includes(currentValue)) {
                    select.value = currentValue;
                }
            }

            // 显示通知提示
            function showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastIcon = document.getElementById('toast-icon');
                const toastMessage = document.getElementById('toast-message');
                
                // 设置消息和图标
                toastMessage.textContent = message;
                
                // 根据类型设置样式
                if (type === 'success') {
                    toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-green-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center gap-2';
                    toastIcon.className = 'fa fa-check-circle text-white';
                } else if (type === 'error') {
                    toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-red-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center gap-2';
                    toastIcon.className = 'fa fa-exclamation-circle text-white';
                } else if (type === 'warning') {
                    toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-yellow-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center gap-2';
                    toastIcon.className = 'fa fa-exclamation-triangle text-white';
                } else {
                    toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-blue-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center gap-2';
                    toastIcon.className = 'fa fa-info-circle text-white';
                }
                
                // 3秒后隐藏
                setTimeout(() => {
                    toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2';
                }, 3000);
            }

            // 初始化分类管理面板
            function initCategoriesPanel() {
                renderCategories();
                initCategoriesChart();
            }

            // 渲染分类列表
            function renderCategories() {
                const categories = getCategories();
                const tableBody = document.getElementById('categories-table-body');
                const categoriesCount = document.getElementById('categories-count').querySelector('span');
                const totalWebsites = getWebsites().length;
                
                categoriesCount.textContent = categories.length;
                
                tableBody.innerHTML = '';
                
                if (categories.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                            <i class="fa fa-folder-open-o text-2xl mb-2"></i>
                            <p>暂无分类数据</p>
                        </td>
                    `;
                    tableBody.appendChild(row);
                    return;
                }
                
                categories.forEach(category => {
                    const count = getWebsiteCountByCategory(category);
                    const percentage = totalWebsites > 0 ? Math.round((count / totalWebsites) * 100) : 0;
                    const icon = getCategoryIcon(category);
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
                                <i class="fa ${icon} text-primary"></i>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${category}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">${count} 个网站</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">${percentage}%</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="edit-category text-primary hover:text-primary/80 mr-3" data-name="${category}">
                                <i class="fa fa-pencil"></i> 编辑
                            </button>
                            <button class="delete-category text-danger hover:text-danger/80" data-name="${category}">
                                <i class="fa fa-trash"></i> 删除
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // 绑定编辑和删除事件
                document.querySelectorAll('.edit-category').forEach(btn => {
                    btn.addEventListener('click', () => editCategory(btn.dataset.name));
                });
                
                document.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', () => showDeleteCategoryConfirm(btn.dataset.name));
                });
            }

            // 初始化分类统计图表
            function initCategoriesChart() {
                const ctx = document.getElementById('categories-chart').getContext('2d');
                const categories = getCategories();
                
                if (categories.length === 0) {
                    // 修复：如果没有分类，清除图表
                    if (window.categoriesChart) {
                        window.categoriesChart.destroy();
                        window.categoriesChart = null;
                    }
                    return;
                }
                
                // 准备图表数据
                const labels = categories;
                const data = categories.map(category => getWebsiteCountByCategory(category));
                const backgroundColors = [
                    '#3B82F6', '#10B981', '#EF4444', '#F59E0B', '#8B5CF6', 
                    '#EC4899', '#6366F1', '#14B8A6', '#F97316', '#64748B'
                ];
                
                // 确保颜色足够
                while (backgroundColors.length < categories.length) {
                    backgroundColors.push(`#${Math.floor(Math.random()*16777215).toString(16)}`);
                }
                
                // 销毁现有图表（如果存在）
                if (window.categoriesChart) {
                    window.categoriesChart.destroy();
                }
                
                // 创建新图表
                window.categoriesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors.slice(0, categories.length),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                        return `${label}: ${value} 个网站 (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 显示删除分类确认对话框 - 修复：允许处理分类下的网站
            function showDeleteCategoryConfirm(categoryName) {
                const websitesInCategory = getWebsiteCountByCategory(categoryName);
                const confirmModal = document.getElementById('confirm-modal');
                const confirmTitle = document.getElementById('confirm-title');
                const confirmMessage = document.getElementById('confirm-message');
                const confirmOk = document.getElementById('confirm-ok');
                const categoryDeleteOptions = document.getElementById('category-delete-options');
                const moveToCategoryContainer = document.getElementById('move-to-category-container');
                const moveToCategory = document.getElementById('move-to-category');
                
                // 设置确认框内容
                confirmTitle.textContent = '确认删除分类';
                confirmMessage.textContent = `您确定要删除分类"${categoryName}"吗？`;
                
                // 如果分类下有网站，显示处理选项
                if (websitesInCategory > 0) {
                    confirmMessage.textContent += ` 该分类下有 ${websitesInCategory} 个网站。`;
                    categoryDeleteOptions.classList.remove('hidden');
                    
                    // 加载其他分类选项
                    loadMoveToCategoryOptions(categoryName);
                    
                    // 处理分类移动选项的显示/隐藏
                    document.querySelectorAll('input[name="category-delete-action"]').forEach(radio => {
                        radio.addEventListener('change', function() {
                            if (this.value === 'move') {
                                moveToCategoryContainer.classList.remove('hidden');
                            } else {
                                moveToCategoryContainer.classList.add('hidden');
                            }
                        });
                    });
                } else {
                    categoryDeleteOptions.classList.add('hidden');
                }
                
                // 显示确认框
                confirmModal.classList.remove('hidden');
                
                // 绑定确认事件
                const okHandler = () => {
                    const action = document.querySelector('input[name="category-delete-action"]:checked')?.value || 'delete';
                    
                    if (websitesInCategory > 0 && action === 'move') {
                        const newCategory = moveToCategory.value;
                        if (newCategory && newCategory !== categoryName) {
                            // 移动网站到新分类
                            moveWebsitesToCategory(categoryName, newCategory);
                        } else {
                            showToast('请选择有效的目标分类', 'error');
                            return;
                        }
                    } else if (websitesInCategory > 0) {
                        // 删除分类下的所有网站
                        deleteWebsitesByCategory(categoryName);
                    }
                    
                    // 删除分类
                    deleteCategory(categoryName);
                    
                    confirmModal.classList.add('hidden');
                    confirmOk.removeEventListener('click', okHandler);
                };
                
                confirmOk.addEventListener('click', okHandler);
            }

            // 加载移动网站的目标分类选项
            function loadMoveToCategoryOptions(currentCategory) {
                const moveToCategory = document.getElementById('move-to-category');
                const categories = getCategories().filter(cat => cat !== currentCategory);
                
                // 清空现有选项
                moveToCategory.innerHTML = '';
                
                // 添加分类选项
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    moveToCategory.appendChild(option);
                });
                
                // 如果没有其他分类，创建一个默认分类
                if (categories.length === 0) {
                    const option = document.createElement('option');
                    option.value = '未分类';
                    option.textContent = '未分类';
                    moveToCategory.appendChild(option);
                }
            }

            // 将分类下的网站移动到新分类
            function moveWebsitesToCategory(oldCategory, newCategory) {
                let websites = getWebsites();
                websites = websites.map(website => 
                    website.category === oldCategory 
                        ? { ...website, category: newCategory }
                        : website
                );
                saveWebsites(websites);
            }

            // 删除指定分类下的所有网站
            function deleteWebsitesByCategory(category) {
                let websites = getWebsites();
                websites = websites.filter(website => website.category !== category);
                saveWebsites(websites);
            }

            // 删除分类
            function deleteCategory(categoryName) {
                // 从分类图标映射中删除
                const categoryIcons = JSON.parse(localStorage.getItem('categoryIcons') || '{}');
                delete categoryIcons[categoryName];
                localStorage.setItem('categoryIcons', JSON.stringify(categoryIcons));
                
                // 重新渲染相关面板
                renderCategories();
                initCategoriesChart();
                renderWebsites();
                loadCategoryOptions('category-filter');
                loadCategoryOptions('website-category');
                
                showToast('分类已删除', 'success');
            }

            // 编辑分类
            function editCategory(categoryName) {
                const icon = getCategoryIcon(categoryName);
                
                document.getElementById('category-id').value = categoryName;
                document.getElementById('category-name').value = categoryName;
                document.getElementById('category-icon').value = icon;
                
                // 设置选中的图标
                document.querySelectorAll('.category-icon-option').forEach(option => {
                    if (option.dataset.icon === icon) {
                        option.classList.add('bg-primary/10', 'border', 'border-primary');
                    } else {
                        option.classList.remove('bg-primary/10', 'border', 'border-primary');
                    }
                });
                
                // 设置模态框标题
                document.getElementById('category-modal-title').textContent = '编辑分类';
                
                // 显示模态框
                document.getElementById('category-modal').classList.remove('hidden');
            }

            // 保存分类 - 修复：处理分类重命名逻辑
            function saveCategory() {
                const originalName = document.getElementById('category-id').value;
                const newName = document.getElementById('category-name').value.trim();
                const icon = document.getElementById('category-icon').value;
                
                // 验证分类名称
                if (!newName) {
                    showToast('分类名称不能为空', 'error');
                    return;
                }
                
                // 检查是否重名（排除自身）
                const categories = getCategories();
                if (categories.includes(newName) && newName !== originalName) {
                    showToast('该分类名称已存在', 'error');
                    return;
                }
                
                // 如果是修改分类名称，需要更新相关网站
                if (originalName && originalName !== newName) {
                    const websites = getWebsites();
                    const updatedWebsites = websites.map(website => 
                        website.category === originalName 
                            ? { ...website, category: newName }
                            : website
                    );
                    saveWebsites(updatedWebsites);
                }
                
                // 保存分类图标
                saveCategoryIcon(newName, icon);
                
                // 如果是删除原始分类（重命名情况）
                if (originalName && originalName !== newName) {
                    const categoryIcons = JSON.parse(localStorage.getItem('categoryIcons') || '{}');
                    delete categoryIcons[originalName];
                    localStorage.setItem('categoryIcons', JSON.stringify(categoryIcons));
                }
                
                // 重新渲染相关面板
                renderCategories();
                initCategoriesChart();
                renderWebsites();
                loadCategoryOptions('category-filter');
                loadCategoryOptions('website-category');
                loadCategoryOptions('batch-new-category');
                
                closeCategoryModal();
                showToast(originalName ? '分类已更新' : '分类已添加', 'success');
            }

            // 关闭分类模态框
            function closeCategoryModal() {
                document.getElementById('category-modal').classList.add('hidden');
                document.getElementById('category-form').reset();
                document.getElementById('category-id').value = '';
                document.getElementById('category-icon').value = 'fa-globe';
                
                // 重置图标选择状态
                document.querySelectorAll('.category-icon-option').forEach(option => {
                    option.classList.remove('bg-primary/10', 'border', 'border-primary');
                });
            }

            // 批量修改分类
            function batchUpdateCategory() {
                const selectedIds = getSelectedWebsiteIds();
                const newCategory = document.getElementById('batch-new-category').value;
                
                if (selectedIds.length === 0) {
                    showToast('请先选择要修改的网站', 'warning');
                    return;
                }
                
                if (!newCategory) {
                    showToast('请选择目标分类', 'warning');
                    return;
                }
                
                // 获取选中网站的旧分类，用于更新统计
                const websites = getWebsites();
                const oldCategories = new Set();
                
                websites.forEach(website => {
                    if (selectedIds.includes(website.id)) {
                        oldCategories.add(website.category);
                    }
                });
                
                // 更新网站分类
                const updatedWebsites = websites.map(website => 
                    selectedIds.includes(website.id)
                        ? { ...website, category: newCategory }
                        : website
                );
                
                saveWebsites(updatedWebsites);
                renderWebsites();
                
                // 只有当分类有变化时才更新分类统计
                if (!oldCategories.has(newCategory) || oldCategories.size > 1) {
                    renderCategories();
                    initCategoriesChart();
                }
                
                document.getElementById('batch-category-modal').classList.add('hidden');
                showToast(`已将${selectedIds.length}个网站修改为"${newCategory}"分类`, 'success');
            }

            // 初始化事件监听器
            function initEventListeners() {
                // 标签页切换
                document.getElementById('websites-tab').addEventListener('click', () => {
                    document.getElementById('websites-panel').classList.remove('hidden');
                    document.getElementById('categories-panel').classList.add('hidden');
                    document.getElementById('settings-panel').classList.add('hidden');
                    
                    document.getElementById('websites-tab').classList.add('border-primary', 'text-primary');
                    document.getElementById('websites-tab').classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('categories-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('categories-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('settings-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('settings-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    renderWebsites();
                });
                
                document.getElementById('categories-tab').addEventListener('click', () => {
                    document.getElementById('websites-panel').classList.add('hidden');
                    document.getElementById('categories-panel').classList.remove('hidden');
                    document.getElementById('settings-panel').classList.add('hidden');
                    
                    document.getElementById('websites-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('websites-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('categories-tab').classList.add('border-primary', 'text-primary');
                    document.getElementById('categories-tab').classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('settings-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('settings-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    initCategoriesPanel();
                });
                
                document.getElementById('settings-tab').addEventListener('click', () => {
                    document.getElementById('websites-panel').classList.add('hidden');
                    document.getElementById('categories-panel').classList.add('hidden');
                    document.getElementById('settings-panel').classList.remove('hidden');
                    
                    document.getElementById('websites-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('websites-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('categories-tab').classList.remove('border-primary', 'text-primary');
                    document.getElementById('categories-tab').classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    document.getElementById('settings-tab').classList.add('border-primary', 'text-primary');
                    document.getElementById('settings-tab').classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                
                // 添加网站按钮
                document.getElementById('add-website-btn').addEventListener('click', () => {
                    document.getElementById('website-modal-title').textContent = '添加网站';
                    document.getElementById('website-form').reset();
                    document.getElementById('website-id').value = '';
                    document.getElementById('website-created-at').value = '';
                    document.getElementById('icon-preview').src = 'https://picsum.photos/40/40';
                    document.getElementById('website-modal').classList.remove('hidden');
                    
                    // 加载分类选项
                    loadCategoryOptions('website-category');
                });
                
                // 添加第一个网站按钮
                document.getElementById('add-first-website').addEventListener('click', () => {
                    document.getElementById('website-modal-title').textContent = '添加网站';
                    document.getElementById('website-form').reset();
                    document.getElementById('website-id').value = '';
                    document.getElementById('website-created-at').value = '';
                    document.getElementById('icon-preview').src = 'https://picsum.photos/40/40';
                    document.getElementById('website-modal').classList.remove('hidden');
                    
                    // 加载分类选项
                    loadCategoryOptions('website-category');
                });
                
                // 关闭网站模态框
                document.getElementById('close-website-modal').addEventListener('click', closeWebsiteModal);
                document.getElementById('cancel-website').addEventListener('click', closeWebsiteModal);
                
                // 保存网站
                document.getElementById('save-website').addEventListener('click', saveWebsite);
                
                // 全选复选框
                document.getElementById('select-all').addEventListener('change', function() {
                    const checkboxes = document.querySelectorAll('.website-select');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                    updateBatchCountText();
                });
                
                // 批量删除
                document.getElementById('batch-delete').addEventListener('click', batchDeleteWebsites);
                
                // 批量修改分类
                document.getElementById('batch-category').addEventListener('click', () => {
                    const selectedCount = getSelectedWebsiteIds().length;
                    
                    if (selectedCount === 0) {
                        showToast('请先选择要修改的网站', 'warning');
                        return;
                    }
                    
                    // 更新计数文本
                    document.getElementById('batch-count-text').querySelector('span').textContent = selectedCount;
                    
                    // 加载分类选项
                    loadCategoryOptions('batch-new-category');
                    
                    // 显示模态框
                    document.getElementById('batch-category-modal').classList.remove('hidden');
                });
                
                // 关闭批量修改分类模态框
                document.getElementById('close-batch-category-modal').addEventListener('click', () => {
                    document.getElementById('batch-category-modal').classList.add('hidden');
                });
                document.getElementById('cancel-batch-category').addEventListener('click', () => {
                    document.getElementById('batch-category-modal').classList.add('hidden');
                });
                
                // 确认批量修改分类
                document.getElementById('confirm-batch-category').addEventListener('click', batchUpdateCategory);
                
                // 添加分类按钮
                document.getElementById('add-category-btn').addEventListener('click', () => {
                    document.getElementById('category-modal-title').textContent = '添加分类';
                    document.getElementById('category-form').reset();
                    document.getElementById('category-id').value = '';
                    document.getElementById('category-icon').value = 'fa-globe';
                    document.getElementById('category-modal').classList.remove('hidden');
                    
                    // 重置图标选择状态
                    document.querySelectorAll('.category-icon-option').forEach(option => {
                        if (option.dataset.icon === 'fa-globe') {
                            option.classList.add('bg-primary/10', 'border', 'border-primary');
                        } else {
                            option.classList.remove('bg-primary/10', 'border', 'border-primary');
                        }
                    });
                });
                
                // 分类图标选择
                document.querySelectorAll('.category-icon-option').forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.preventDefault();
                        const icon = this.dataset.icon;
                        
                        // 更新隐藏字段
                        document.getElementById('category-icon').value = icon;
                        
                        // 更新选中状态
                        document.querySelectorAll('.category-icon-option').forEach(opt => {
                            if (opt.dataset.icon === icon) {
                                opt.classList.add('bg-primary/10', 'border', 'border-primary');
                            } else {
                                opt.classList.remove('bg-primary/10', 'border', 'border-primary');
                            }
                        });
                    });
                });
                
                // 关闭分类模态框
                document.getElementById('close-category-modal').addEventListener('click', closeCategoryModal);
                document.getElementById('cancel-category').addEventListener('click', closeCategoryModal);
                
                // 保存分类
                document.getElementById('save-category').addEventListener('click', saveCategory);
                
                // 关闭确认对话框
                document.getElementById('confirm-cancel').addEventListener('click', () => {
                    document.getElementById('confirm-modal').classList.add('hidden');
                });
                
                // 关闭状态提示栏
                document.getElementById('close-status').addEventListener('click', () => {
                    document.getElementById('status-bar').classList.add('hidden');
                });
                
                // 自动获取图标
                document.getElementById('auto-fetch-icon').addEventListener('click', function() {
                    const url = document.getElementById('website-url').value;
                    if (url) {
                        const faviconUrl = getFaviconUrl(url);
                        document.getElementById('website-icon').value = faviconUrl;
                        updateIconPreview(faviconUrl);
                    } else {
                        showToast('请先输入网站URL', 'warning');
                    }
                });
                
                // 网站搜索
                document.getElementById('websites-search').addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const websites = getWebsites();
                    
                    if (!searchTerm) {
                        renderWebsites();
                        return;
                    }
                    
                    const filtered = websites.filter(website => 
                        website.name.toLowerCase().includes(searchTerm) || 
                        website.url.toLowerCase().includes(searchTerm)
                    );
                    
                    renderWebsites(filtered);
                });
                
                // 分类筛选
                document.getElementById('category-filter').addEventListener('change', function() {
                    const category = this.value;
                    const websites = getWebsites();
                    
                    if (!category) {
                        renderWebsites();
                        return;
                    }
                    
                    const filtered = websites.filter(website => website.category === category);
                    renderWebsites(filtered);
                });
                
                // 清除筛选条件
                document.getElementById('clear-filters').addEventListener('click', function() {
                    document.getElementById('websites-search').value = '';
                    document.getElementById('category-filter').value = '';
                    renderWebsites();
                });
                
                // 预览Logo
                document.getElementById('preview-logo').addEventListener('click', function() {
                    const logoUrl = document.getElementById('site-logo').value;
                    const previewContainer = document.getElementById('logo-preview-container');
                    const previewImg = document.getElementById('logo-preview');
                    
                    if (logoUrl) {
                        previewImg.src = logoUrl;
                        previewContainer.classList.remove('hidden');
                        
                        // 图片加载失败处理
                        previewImg.onerror = function() {
                            this.src = 'https://picsum.photos/48/48';
                            showToast('Logo图片加载失败，显示默认图片', 'warning');
                        };
                    } else {
                        previewContainer.classList.add('hidden');
                        showToast('请输入Logo URL', 'warning');
                    }
                });
                
                // 保存设置
                document.getElementById('save-settings').addEventListener('click', function() {
                    const siteName = document.getElementById('site-name').value;
                    const siteDescription = document.getElementById('site-description').value;
                    const siteLogo = document.getElementById('site-logo').value;
                    const theme = document.querySelector('input[name="theme"]:checked').value;
                    
                    // 保存设置到localStorage
                    const settings = {
                        siteName,
                        siteDescription,
                        siteLogo,
                        theme
                    };
                    
                    localStorage.setItem('settings', JSON.stringify(settings));
                    showToast('设置已保存', 'success');
                });
            }

            // 初始化管理面板
            function init() {
                // 初始化最后更新时间
                initLastUpdateTime();
                
                // 加载分类选项
                loadCategoryOptions('category-filter');
                
                // 渲染网站列表
                renderWebsites();
                
                // 初始化事件监听器
                initEventListeners();
            }

            // 启动初始化
            init();
        }
    </script>
</body>
</html>
